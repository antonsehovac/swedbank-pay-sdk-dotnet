@model SwedbankPayCheckoutSource
@{
    ViewData["Title"] = "Index";
    var containerId = Guid.NewGuid();
}

<h1>SwedbankPay menu</h1>
<span>@Model.PaymentOrderId.ToString()</span>

<div id="swedbankpay-checkout">
    <div>
        <div id="checkin-@containerId"></div>
    </div>
    <div id="paymentMenuFrame">
        <div id="swedbankpay-paymentmenu-@containerId"></div>
    </div>
    <div>
        <div id="checkout-@containerId"></div>
    </div>
</div>


<script type="text/javascript">
    var paymentMenuConfig = {
        container: {
            checkout: 'checkout-@containerId'
        },
        culture: '@Model.Culture.Name',
    };


    function displaySeamlessView(menuScript) {
        var script = document.createElement('script');
        script.setAttribute('src', menuScript);
        script.onload = function () {
            // When the 'view-checkout' script is loaded, we can initialize the
            // Payment Menu inside 'checkout-container'.
            window.payex.hostedView.checkout(paymentMenuConfig).open('checkout');
        };
        // Append the Checkout script to the <head>
        var head = document.getElementsByTagName('head')[0];
        head.appendChild(script);
    };

    displaySeamlessView('@Model.JavascriptSource');
</script>

@if (!string.IsNullOrEmpty(Model.AbortOperationLink?.OriginalString))
{
    <div class="row justify-content-center">
        <div class="col">
            <form asp-action="AbortPaymentOrder" asp-controller="Payment" method="post">
                <input type="hidden" name="paymentOrderId"
                   value="@Model.AbortOperationLink.OriginalString" />
                <button type="submit" class="btn btn-lg btn-danger" automation="button-abort">
                    Abort
                </button>
            </form>
        </div>
    </div>
}